

4. Configuration par défaut du noyau

4.1.	Config par défaut de la carte Hikey : TP3/hikey-linaro/arch/arm64/configs/hikey_defconfig

4.2.	* Compilation croisée parce que env cible différent de env hôte et que machine hôte plus puissante que machine cible (build plus rapide en cross-comp)
		* Etapes pour préparer l'environnement avant compil : 
			* s'assurer de disposer de la toolchain précompilée complète (binaires de cross-compilation)
			* s'assurer de disposer de Python sur la machine hôte
			* configurer ARCH et CROSS_COMPILE via une méthode au choix (var dans makefile du kernel, var d'environement ou passé en paramètre lors du make)

4.3.	* Script shell avec :
			* ARCH=arm64
			* CROSS_COMPILE=~/TP3/aarch64-linux-android-4.9/bin/aarch64-linux-android-
			* export ARCH
			* export CROSS_COMPILE
			
4.4		* FAIT

4.5		* "configuration written to .config" a été écrit dans la console, et un fichier .config a été créé
		* le fichier résultant contient beaucoup plus de lignes de paramètres de configuration (107kb, contre 10kb pour le fichier de config initial), 
			potentiellement tous les paramètres possibles, et ceux qui n'étaient pas spécifié sont en commentaire et sont suivi de "is not set".

4.6 	* FAIT

4.7 	* FAIT

5. Configuration avancée du noyau 

5.1 	* compat ARMv8 Versatile uniquement : définir une envvar "ARCH" to "ARMv8 Versatile" 

		*  option
			* NFC : Networking support -> NFC subsystem support -> all options to Y
			* driver de l'émulateur matériel : Networking support -> NFC subsystem support -> Near Field Communication (NFC) Devices -> "NFC Hardware simulator driver" to Y

		* driver carte Intel PRO/Wireless 2200BG : Device Driver -> network device support-> Wireless LAN -> "Intel PRO/Wireless 2200BG and 2915ABG Network Connection" to Y

		* GPU 16 -> 32 : Device Driver -> Graphic support -> VGA Arbitration -> "Maximum number of GPUs" to 32

		* activation option logo/image au boot : Device Drivers -> Graphics Support -> "Bootup logo" to Y -> "Black and white linux logo" to Y

		* USB
			* désactiv MTP Gadget : Device Drivers -> USB support -> USB Gadget Support -> "MTP gadget" to N
			* activ USB LED : Device Drivers -> USB support -> "USB LED driver support" to Y

		* mettre en dur TI SOC Drivers : Device Drivers -> SOC (System On Chip) specific Drivers -> "TI SOC drivers support" to Y

5.2		config du wakelock : Power Management and ACPI options -> "user space wakeup sources interface" to Y

5.3 	FAIT

5.4 	TODO



*************************** Jeudi aprem *****************************************

Suite à la commande diff (diff entre fichier final et fichier intial)



diff hikeylo52_defcong hikey_defconfig 

0a1
> CONFIG_LOCALVERSION_AUTO=y
181a183
> CONFIG_CFG80211_WEXT=y
190,196d191
< CONFIG_NFC=y
< CONFIG_NFC_DIGITAL=y
< CONFIG_NFC_NCI=y
< CONFIG_NFC_NCI_SPI=y
< CONFIG_NFC_HCI=y
< CONFIG_NFC_SHDLC=y
< CONFIG_NFC_SIM=y
243d237
< CONFIG_IPW2200=y
285d278
< CONFIG_VGA_ARB_MAX_GPUS=32
298,300d290
< CONFIG_LOGO=y
< # CONFIG_LOGO_LINUX_VGA16 is not set
< # CONFIG_LOGO_LINUX_CLUT224 is not set
321d310
< CONFIG_USB_LED=y
329a319,320
> CONFIG_USB_CONFIGFS_F_MTP=y
> CONFIG_USB_CONFIGFS_F_PTP=y
366d356
< CONFIG_SOC_TI=y
424a415
> CONFIG_CRYPTO_MICHAEL_MIC=y
432a424
> CONFIG_CRC_CCITT=y





diff .config .configOr 

gOr 
917d916
< CONFIG_WIRELESS_EXT=y
920,921d918
< CONFIG_WEXT_SPY=y
< CONFIG_WEXT_PRIV=y
930,935c927
< CONFIG_CFG80211_WEXT_EXPORT=y
< CONFIG_LIB80211=y
< CONFIG_LIB80211_CRYPT_WEP=y
< CONFIG_LIB80211_CRYPT_CCMP=y
< CONFIG_LIB80211_CRYPT_TKIP=y
< # CONFIG_LIB80211_DEBUG is not set
---
> # CONFIG_LIB80211 is not set
959,979c951
< CONFIG_NFC=y
< CONFIG_NFC_DIGITAL=y
< CONFIG_NFC_NCI=y
< CONFIG_NFC_NCI_SPI=y
< CONFIG_NFC_HCI=y
< CONFIG_NFC_SHDLC=y
< 
< #
< # Near Field Communication (NFC) devices
< #
< # CONFIG_NFC_PN533 is not set
< # CONFIG_NFC_WILINK is not set
< # CONFIG_NFC_TRF7970A is not set
< CONFIG_NFC_SIM=y
< # CONFIG_NFC_PORT100 is not set
< # CONFIG_NFC_PN544 is not set
< # CONFIG_NFC_MICROREAD is not set
< # CONFIG_NFC_MRVL is not set
< # CONFIG_NFC_ST21NFCA is not set
< # CONFIG_NFC_ST21NFCB is not set
< # CONFIG_NFC_NXP_NCI is not set
---
> # CONFIG_NFC is not set
1606,1611c1578
< CONFIG_IPW2200=y
< # CONFIG_IPW2200_MONITOR is not set
< # CONFIG_IPW2200_QOS is not set
< # CONFIG_IPW2200_DEBUG is not set
< CONFIG_LIBIPW=y
< # CONFIG_LIBIPW_DEBUG is not set
---
> # CONFIG_IPW2200 is not set
2540c2507
< CONFIG_VGA_ARB_MAX_GPUS=32
---
> CONFIG_VGA_ARB_MAX_GPUS=16
2677,2680c2644
< CONFIG_LOGO=y
< CONFIG_LOGO_LINUX_MONO=y
< # CONFIG_LOGO_LINUX_VGA16 is not set
< # CONFIG_LOGO_LINUX_CLUT224 is not set
---
> # CONFIG_LOGO is not set
3039c3003
< CONFIG_USB_LED=y
---
> # CONFIG_USB_LED is not set
3099a3064,3065
> CONFIG_USB_F_MTP=y
> CONFIG_USB_F_PTP=y
3113c3079,3080
< # CONFIG_USB_CONFIGFS_F_MTP is not set
---
> CONFIG_USB_CONFIGFS_F_MTP=y
> CONFIG_USB_CONFIGFS_F_PTP=y
3469c3436
< CONFIG_SOC_TI=y
---
> # CONFIG_SOC_TI is not set



*******************Commande kernel compil ******************************

make hikey_defconfig -> pour charger le configuration par defaut

ARCH=arm64
export ARCH
CROSS_COMPILE=/media/promet/Documents/UTBM/Cours_Filiere_Infos/Cours/LO52/Noyau+linaro/aarch64-linux-android-4.9/bin/aarch64-linux-android-
export CROSS_COMPILE

make menuconfig

make -> pour compiler le kernel

make savedefconfig” pour créer le fichier

”mv defconfig arch/ < arch > /configs/ < filename > ” -> déplace le fichier créé et le renome


RESULTAT:

Initial kernel: vmlinux : 13.3

Final kernel: vmlinux : 13.6